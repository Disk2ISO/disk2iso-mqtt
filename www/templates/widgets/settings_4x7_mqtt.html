<!-- MQTT Widget Settings (4x7) -->
<!-- Dynamisch geladen via settings_4x7_mqtt.js -->
<div class="form-section" id="mqtt-widget-settings">
    <h2>
        <img src="{{ url_for('static', filename='img/mqtt.svg') }}" alt="" style="width:24px;height:24px;vertical-align:middle;margin-right:8px;">
        MQTT Integration
    </h2>
    
    <div class="form-group">
        <label>
            <input type="checkbox" id="mqtt_enabled" name="mqtt_enabled" {{ 'checked' if settings.mqtt_enabled else '' }}>
            {{ t.SYSTEM_MQTT_ENABLED if t else 'MQTT aktivieren' }}
        </label>
        <div class="help-text">Aktiviert Home Assistant Integration via MQTT</div>
    </div>
    
    <div id="mqtt-settings" style="{{ 'display: block;' if settings.mqtt_enabled else 'display: none;' }}">
        <div class="form-group">
            <label for="mqtt_broker">MQTT Broker</label>
            <input type="text" id="mqtt_broker" name="mqtt_broker" value="{{ settings.mqtt_broker }}" placeholder="192.168.20.10">
            <div class="help-text">IP-Adresse oder Hostname des MQTT Brokers</div>
        </div>
        
        <div class="form-group">
            <label for="mqtt_port">MQTT Port</label>
            <input type="number" id="mqtt_port" name="mqtt_port" value="{{ settings.mqtt_port }}" min="1" max="65535" placeholder="1883">
            <div class="help-text">Standard: 1883</div>
        </div>
        
        <div class="form-group">
            <label>
                <input type="checkbox" id="mqtt_auth_enabled" {{ 'checked' if settings.mqtt_user else '' }}>
                MQTT Anmeldung erforderlich
            </label>
            <div class="help-text">Aktivieren wenn Broker Authentifizierung ben√∂tigt</div>
        </div>
        
        <div id="mqtt-auth-settings" style="{{ 'display: block;' if settings.mqtt_user else 'display: none;' }}">
            <div class="form-group">
                <label for="mqtt_user">MQTT Benutzername</label>
                <input type="text" id="mqtt_user" name="mqtt_user" value="{{ settings.mqtt_user }}" placeholder="">
                <div class="help-text">Benutzername f√ºr MQTT Broker</div>
            </div>
            
            <div class="form-group">
                <label for="mqtt_password">MQTT Passwort</label>
                <div class="password-input-wrapper">
                    <input type="password" id="mqtt_password" name="mqtt_password" class="password-input" value="{{ settings.mqtt_password }}" placeholder="">
                    <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('mqtt_password')" title="Passwort anzeigen/verbergen">
                        <span class="toggle-icon" id="mqtt_password_icon">üëÅÔ∏è</span>
                    </button>
                </div>
                <div class="help-text">Passwort f√ºr MQTT Broker. Wird nach 20 Sekunden automatisch verborgen.</div>
            </div>
        </div>
        
        <div class="form-group">
            <button type="button" id="mqtt-test-btn" class="btn btn-secondary" onclick="testMqttConnection()">
                üîå Verbindung testen
            </button>
            <span id="mqtt-test-result" style="margin-left: 15px; font-weight: 600;"></span>
        </div>
    </div>
</div>

